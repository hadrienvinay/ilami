{% extends "base.html.twig" %}

{% block title %}{{ parent() }} - Calendrier{% endblock %}


{% block body %}
    <br>
    <div class="container" style="padding: 3%;margin-top: 3%;margin-bottom: 3%;border-radius: 0.5rem;background: #fff;">
        <h1 class="text-center">Le P'tit Calendrier</h1>
        <br>
        <div id='calendar'></div>
        </div>

    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: ['interaction', 'dayGrid'],
                firstDay: 1,
                locale: 'fr',
                defaultView : 'dayGridMonth',
                selectable: true,
                events: [
                    {% for event in events %}
                    {
                        title: '{{ event.name }}',
                        start: '{{ event.startdate|date('Y-m-d') }}',
                        end: '{{ event.enddate|date('Y-m-d') }}',
                        url: '{{ path('event', { id: event.id})  }}'
                    },
                    {% endfor %}
                    {% for user in users %}
                    {
                        title: 'Anniversaire {{ user.prename }}',
                        start: '2019-{{ user.birthdate|date('m-d') }}',
                        allDay : true
                    },
                    {
                        title: 'Anniversaire {{ user.prename }}',
                        start: '2020-{{ user.birthdate|date('m-d') }}',
                        allDay : true
                    },
                    {% endfor %}
                    {
                        title: 'test',
                        start: '2019-07-20',
                        end: '2019-07-20'
                    }
                ],
                dateClick: function(info) {
                    alert('clicked ' + info.dateStr);
                },
                select: function(info) {
                    if ((info.end - info.start) > 86400000)
                    {
                        var my_route = Routing.generate('add_event', {start : info.start.getTime(), end : info.end.getTime()})
                        window.location.replace(my_route);
                    }
                }
            });

            calendar.render();
        });

    </script>
{% endblock %}

