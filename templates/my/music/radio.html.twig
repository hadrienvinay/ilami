{% extends 'base.html.twig' %}

{% block title %}Radio Imali{% endblock %}

{% block body %}
    <br>
    <div class="container" style="padding: 3%;margin-top: 3%;margin-bottom: 3%;border-radius: 0.5rem;background: #fff;">   
        <h1 class="text-center">La P'tite Radio ðŸŽµ</h1>
        <div class="my-3 p-3 bg-white rounded box-shadow">
            <small class="d-block text-right mt-3">
                <a class="btn-sm btn-outline-success no-decoration add-song" href="{{ path('add_song') }}">
                <i class="fa fa-plus-square" aria-hidden="true"></i>
                    Ajouter un son
                </a>
            </small>
            <h6 class="border-bottom border-gray pb-2 mb-0">Les p'tits sons du moment</h6>
            {% for song in songs|sort((a, b) => a.createddate <=> b.createddate)%}
                <div class="media text-muted pt-3">
                    <img alt="Musique" class="mr-2 rounded" style="width: 32px; height: 32px;" src="{{ asset('build/images/musique/soundcloud.png') }}">
                    <p class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                        <audio id="audioPlayer{{loop.index}}" controls="controls" style="float: right;margin-right: 25%;">
                            {#<source src="{{ song.fileName }}.ogg">#}
                            <source src="{{ asset("build/downloads/"~song.fileName )}}">
                        </audio> 
                            <strong class="d-block text-gray-dark">{{ song.fileName }}</strong>
                            UploadÃ© par <a href="{{ path('profile',{id:song.uploader.id}) }}">{{ song.uploader.username }}</a> {{ song.createddate|time_diff() }}
                    </p>
                    {% if is_granted('ROLE_ADMIN') %}
                        <a id="delete_song{{ song.id }}" class="btn-sm btn-danger no-decoration delete-song" href="{{ path('delete_song',{'id': song.id}) }}">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                        </a>
                    {% endif %}
               </div>
            {% endfor %}
        </div>
    </div>
        
    <!-- Modal add a song -->
    <div id="addSongModal" class="modal" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title">Ajout d'une P'tite Musique</h5>
                   <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                       <span aria-hidden="true">&times;</span>
                   </button>
               </div>
               <div class="modal-body">
                   {{ form_start(form, {'method': 'post', 'action': path('add_song')}) }}
                   {{ form_widget(form, {'attr': {'class': 'form-group'}}) }}
               </div>
                <div class="modal-footer">
                   <div class="form-group middle">
                       <input class=" btn btn-primary" type="submit" value="Ajouter" />
                   </div>
                   {{ form_rest(form) }}
                   {{ form_end(form) }}
               </div>
            </div>
        </div>
    </div>
            
    <!-- Modal delete an song-->
    <div id="deleteSongModal" class="modal" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title">Suppression d'une musique</h5>
                   <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                       <span aria-hidden="true">&times;</span>
                   </button>
               </div>
               <div class="modal-body">
                   <p>Vous allez supprimer cette musique </p>
                   <p>Etes-vous sur?</p>
               </div>
               <div class="modal-footer">
                   <a href="" id="btnYes" class="btn btn-danger" data="">Oui</a>
                   <a href="#" data-dismiss="modal" aria-hidden="true" class="btn btn-primary">Non</a>
               </div>
            </div>
        </div>
    </div>
            
        <script>
           
            $(document).ready(function (){                     
                //Modal management
                var modal = document.getElementById("deleteSongModal");
                var modal2 = document.getElementById("addSongModal");

                $('.add-song').on('click', function(e) {
                    e.preventDefault();
                    $('#addSongModal').modal('show');
                });

                $('.delete-song').on('click', function(e) {
                    e.preventDefault();
                    var href = $(this).attr("href");
                    var id = $(this).attr("id");
                    $('#btnYes').attr("href",href);
                    $('#btnYes').attr("data",id);
                    $('#deleteSongModal').modal('show');
                });
                //delete an event and the correponding bloc
                $('#btnYes').on('click', function (e) {
                    //e.preventDefault();
                    //var notifUrl = $(this).attr('href');
                    //var div = $(this).attr('data');
                    //var divNum = div.replace('delete_event','');
                    //$.ajax({url: notifUrl,
                     //   success: function(result){
                      //      $('#event'+ divNum).remove();
                       // }});
                });

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
              if (event.target == modal) {
                modal.style.display = "none";
              }
              if (event.target == modal2) {
                modal2.style.display = "none";
              }
            };

        });
        </script>

{% endblock %}
