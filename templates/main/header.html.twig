<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="margin-bottom: 20px;">
    <div class="container-fluid">
        <a class="navbar-brand" href="{{ path('main_app') }}">
            Imalipusram Website
            <img src="{{asset('build/images/imali.png')}}" style="width: 50px;" title="logo" alt="Logo Imali">
        </a>
        <div class="myNavbar">
            <ul id="navContent" class="navbar-nav ml-auto" style="margin-right: 2%;">
                {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                    <li class="nav-item" style="margin:auto;">
                        <a class="nav-link" style="display:flex;" href="{{ path('profile',{'id': app.user.id}) }}" data-toggle="tooltip" data-placement="bottom" title="Mon profil">
                            <img class="myPic" src="{{asset('build/images/profile/' ~ app.user.username ~ '.jpg')}}" alt="Mon profil">
                            <div class="minimize" style="padding-left: 10%;">
                                {{ app.user.username }}
                            </div>
                        </a>
                    </li>
                    {% if is_granted('ROLE_ADMIN') %}
                        <li class="nav-item tab-item">
                            <a class="nav-link" href="{{ path('admin') }}" data-toggle="tooltip" data-placement="bottom" title="Admin Dashboard" style="color:white;">
                                üëª
                            </a>
                        </li>  
                    {% endif %}
                    <li id="notif" class="nav-item tab-item dropdown" title="Notifications">
                        <a id="notif_btn" class="nav-link dropdown" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: #fff;"> 
                            {% if mgilet_notification_unseen_count(app.user) > 0 %}<span class="notification">{{ mgilet_notification_unseen_count(app.user) }}</span> {% endif %}
                            üîî
                        </a>
                        <div id="notif_content" class="dropdown-menu" aria-labelledby="dropdown01" style="min-width: 333px;">
                            {% if notificationList|length > 0 %}
                                <small style="margin-left:1.5rem;">
                                    <a id="all-seen" data="{{ mgilet_notification_generate_path('notification_mark_all_as_seen', notificationList|first.notifiableEntity) }}" href="">
                                        <i class="fa fa-eye" aria-hidden="true"></i>
                                        Tout marquer comme vu
                                    </a>
                                </small>
                                <div class="dropdown-divider"></div>
                            {% else %}
                                <div class="text-center"><i>Aucune notification</i> üßê</div>
                            {% endif %}
                            {% for item in notificationList | slice(0,8) %}
                                <a class="dropdown-item notif-content" {% if not item.seen %}style="background-color:#edf2fa;" data="{{ mgilet_notification_generate_path('notification_mark_as_seen', item.notifiableEntity, item.notification) }}" {% else %} data="" {% endif %} href="{{ path('main_app') }}{{ item.notification.link }}">
                                       <b>{{ item.notification.subject }}</b>
                                       <i>{{ item.notification.message }}</i>
                                       <br>
                                       <i>{{ item.notification.date|time_diff }}</i>
                                    <!--
                                    form action="{{ mgilet_notification_generate_path('notification_mark_as_seen', item.notifiableEntity, item.notification) }}"
                                          method="post">
                                        <button type="submit">Mark as seen</button>
                                    </form>
                                    <form action="{{ mgilet_notification_generate_path('notification_mark_as_unseen', item.notifiableEntity, item.notification) }}"
                                          method="post">
                                        <button type="submit">Mark as unseen</button>
                                    </form>
                                    -->
                                </a>
                            {% endfor %}
                        </div>
                    </li>
                    <li id="menu-dropdown" class="nav-item tab-item dropdown" title="Rubriques">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: #fff;">
                            üóÇÔ∏è
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="{{ path('resume') }}">
                                ü•Ç What's up
                            </a>
                            <a class="dropdown-item" href="{{ path('gallery') }}">
                                üèñÔ∏è Gallerie Photo
                            </a>    
                            <a class="dropdown-item" href="{{ path('calendar') }}">
                                üìÜ Calendrier
                            </a>
                            <a class="dropdown-item" href="{{ path('media') }}">
                               üí° M√©dias
                            </a>
                            <a class="dropdown-item" href="{{ path('radio') }}">
                               üíÉ Radio
                            </a>
                            <a class="dropdown-item" href="{{ path('map') }}">
                                üó∫Ô∏è Map
                            </a>
                            <a class="dropdown-item" href="{{ path('catan') }}">
                                üêë Catan
                            </a>
                            {% if app.user.username == "suri" %}             
                                <a class="dropdown-item" href="{{ path('timetable') }}">
                                    üöå TimeTable
                                </a>  
                            {% endif %}
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="{{ path('fos_user_security_logout') }}">
                                <span class="fa fa-sign-out"></span> {{ 'layout.logout'|trans({}, 'FOSUserBundle') }}
                            </a>
                        </div>
                    </li>

                {% else %}
                    <li class="nav-item">
                        <a class="btn btn-primary" href="{{ path('fos_user_security_login') }}">
                            {{ 'layout.login'|trans({}, 'FOSUserBundle') }} üîë
                        </a>
                    </li>
                {% endif %}
            </ul>
            {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                <form class="form-inline" style="margin-right:8%;">
                    <input id="search" class="form-control mr-sm-2" placeholder="Rechercher" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit"  data-toggle="tooltip" data-placement="bottom" title="Rechercher">
                        üîç
                    </button>
                </form>
            {% endif %}
        </div>
       
    </div>
</nav>
            
<script>
    $(document).ready(function(){
        //Autocomplete
        $("#search").autocomplete({
            source: "{{ path('autocomplete_search') }}",
            minLength: 1,
            autoFocus: true,
            select: function( event, ui ) {
                var my_route;
                if(ui.item.category == 'user')
                    my_route = Routing.generate('profile',{id: ui.item.label});
                else if(ui.item.category == 'event')
                    my_route = Routing.generate('event',{id: ui.item.label});
                else if(ui.item.category == 'album')
                    my_route = Routing.generate('album',{id: ui.item.label});
                
                window.location.replace(my_route);
            }
            
        })
        .autocomplete("instance")._renderItem = function( ul, item ) {
            if(item.category == 'user'){
                return $("<li>")
                  .append("<div>" + "<img src='{{asset('build/images/profile/')}}"+ item.value + ".jpg' style='width: 10%;height: 100%;border-radius: 10%;'>" + " " + item.value + "</div>")
                  .appendTo(ul);
            }
            if(item.category == 'event'){
                return $("<li>")
                  .append("<div>" + "<img src='{{asset('build/images/dashboard/event.jpg')}}' style='width: 10%;height: 100%;border-radius: 10%;'>" + " " + item.value + "</div>")
                  .appendTo(ul);
            }
            if(item.category == 'album'){
                return $("<li>")
                  .append("<div>" + "<img src='{{asset('build/images/gallery/default.png')}}' style='width: 10%;height: 100%;border-radius: 10%;'>" + " " + item.value + "</div>")
                  .appendTo(ul);
            }
        };
        
      
        $('[data-toggle="tooltip"]').tooltip();  
        //$('[data-toggle="tooltip"]').tooltip({ trigger: "hover" });  

        $('.notif-content').click(function(){
            var url = $(this).attr("data");
            if(url !== ""){
                $.ajax({
                   url: url
                });
            }
        });
        $('#all-seen').click(function(e){
            e.preventDefault();
            e.stopPropagation();
            var url = $(this).attr("data");
            $('.notification').remove();

            $.ajax({
               url: url,
               success: function(data) {
                    $('.notif-content').css("background-color","transparent"); 
                   }
               });
        });
    });
        
</script>
